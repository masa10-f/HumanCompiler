# Supabase „Éá„Éº„Çø„Éô„Éº„ÇπË®≠ÂÆöÊâãÈ†ÜÊõ∏

## ÁèæÂú®„ÅÆÁä∂Ê≥Å
- ‚úÖ DATABASE_URL „ÅÆ„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„ÅØÊ≠£„Åó„ÅÑ: `VxnZc8.cn%266G%3F`
- ‚úÖ Supabase REST API „ÅÆÊé•Á∂ö„ÅØÊ≠£Â∏∏
- ‚ùå „Éá„Éº„Çø„Éô„Éº„Çπ„ÉÜ„Éº„Éñ„É´„ÅåÊú™‰ΩúÊàê

## üìã Ëß£Ê±∫ÊâãÈ†Ü

### 1. Supabase Dashboard „Å´„Ç¢„ÇØ„Çª„Çπ
1. „Éñ„É©„Ç¶„Ç∂„Åß [https://supabase.com/dashboard](https://supabase.com/dashboard) „ÇíÈñã„Åè
2. „Éó„É≠„Ç∏„Çß„ÇØ„Éà `vmnzbdfatpckhqegkntk` „ÇíÈÅ∏Êäû

### 2. SQL Editor „Åß„ÉÜ„Éº„Éñ„É´‰ΩúÊàê
1. Â∑¶„Çµ„Ç§„Éâ„Éê„Éº„Åã„Çâ **SQL Editor** „Çí„ÇØ„É™„ÉÉ„ÇØ
2. **New query** „Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
3. ‰ª•‰∏ã„ÅÆSQLÂÖ®‰Ωì„Çí„Ç≥„Éî„Éº&„Éö„Éº„Çπ„Éà„Åó„Å¶ÂÆüË°å

```sql
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create users table (extends auth.users)
CREATE TABLE IF NOT EXISTS public.users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email TEXT UNIQUE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create projects table
CREATE TABLE IF NOT EXISTS public.projects (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    owner_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create goals table
CREATE TABLE IF NOT EXISTS public.goals (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL REFERENCES public.projects(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    description TEXT,
    estimate_hours DECIMAL(5,2) NOT NULL CHECK (estimate_hours > 0),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create tasks table
CREATE TABLE IF NOT EXISTS public.tasks (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    goal_id UUID NOT NULL REFERENCES public.goals(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    description TEXT,
    estimate_hours DECIMAL(5,2) NOT NULL CHECK (estimate_hours > 0),
    due_date TIMESTAMP WITH TIME ZONE,
    status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'in_progress', 'completed', 'cancelled')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create schedules table
CREATE TABLE IF NOT EXISTS public.schedules (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
    date DATE NOT NULL,
    plan_json JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, date)
);

-- Create logs table
CREATE TABLE IF NOT EXISTS public.logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    task_id UUID NOT NULL REFERENCES public.tasks(id) ON DELETE CASCADE,
    actual_minutes INTEGER NOT NULL CHECK (actual_minutes > 0),
    comment TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create indexes for performance
CREATE INDEX IF NOT EXISTS idx_projects_owner_id ON public.projects(owner_id);
CREATE INDEX IF NOT EXISTS idx_goals_project_id ON public.goals(project_id);
CREATE INDEX IF NOT EXISTS idx_tasks_goal_id ON public.tasks(goal_id);
CREATE INDEX IF NOT EXISTS idx_tasks_status ON public.tasks(status);
CREATE INDEX IF NOT EXISTS idx_tasks_due_date ON public.tasks(due_date);
CREATE INDEX IF NOT EXISTS idx_schedules_user_date ON public.schedules(user_id, date);
CREATE INDEX IF NOT EXISTS idx_logs_task_id ON public.logs(task_id);
CREATE INDEX IF NOT EXISTS idx_logs_created_at ON public.logs(created_at);

-- Create update trigger function
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

-- Create update triggers
CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON public.users FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_projects_updated_at BEFORE UPDATE ON public.projects FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_goals_updated_at BEFORE UPDATE ON public.goals FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_tasks_updated_at BEFORE UPDATE ON public.tasks FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_schedules_updated_at BEFORE UPDATE ON public.schedules FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

### 3. Row Level Security (RLS) „Éù„É™„Ç∑„Éº„ÅÆËøΩÂä†
„ÉÜ„Éº„Éñ„É´‰ΩúÊàêÂæå„ÄÅÁ∂ö„Åë„Å¶‰ª•‰∏ã„ÅÆSQL„ÇÇÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö

```sql
-- Enable Row Level Security
ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.projects ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.goals ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tasks ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.schedules ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.logs ENABLE ROW LEVEL SECURITY;

-- Users table policies
CREATE POLICY "Users can read own data" ON public.users
    FOR SELECT USING (auth.uid()::text = id::text);

CREATE POLICY "Users can update own data" ON public.users
    FOR UPDATE USING (auth.uid()::text = id::text);

-- Projects table policies
CREATE POLICY "Users can read own projects" ON public.projects
    FOR SELECT USING (auth.uid()::text = owner_id::text);

CREATE POLICY "Users can create own projects" ON public.projects
    FOR INSERT WITH CHECK (auth.uid()::text = owner_id::text);

CREATE POLICY "Users can update own projects" ON public.projects
    FOR UPDATE USING (auth.uid()::text = owner_id::text);

CREATE POLICY "Users can delete own projects" ON public.projects
    FOR DELETE USING (auth.uid()::text = owner_id::text);

-- Goals table policies
CREATE POLICY "Users can read goals from own projects" ON public.goals
    FOR SELECT USING (
        EXISTS (
            SELECT 1 FROM public.projects 
            WHERE projects.id = goals.project_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

CREATE POLICY "Users can create goals for own projects" ON public.goals
    FOR INSERT WITH CHECK (
        EXISTS (
            SELECT 1 FROM public.projects 
            WHERE projects.id = goals.project_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

CREATE POLICY "Users can update goals from own projects" ON public.goals
    FOR UPDATE USING (
        EXISTS (
            SELECT 1 FROM public.projects 
            WHERE projects.id = goals.project_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

CREATE POLICY "Users can delete goals from own projects" ON public.goals
    FOR DELETE USING (
        EXISTS (
            SELECT 1 FROM public.projects 
            WHERE projects.id = goals.project_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

-- Tasks table policies
CREATE POLICY "Users can read tasks from own goals" ON public.tasks
    FOR SELECT USING (
        EXISTS (
            SELECT 1 FROM public.goals 
            JOIN public.projects ON projects.id = goals.project_id
            WHERE goals.id = tasks.goal_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

CREATE POLICY "Users can create tasks for own goals" ON public.tasks
    FOR INSERT WITH CHECK (
        EXISTS (
            SELECT 1 FROM public.goals 
            JOIN public.projects ON projects.id = goals.project_id
            WHERE goals.id = tasks.goal_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

CREATE POLICY "Users can update tasks from own goals" ON public.tasks
    FOR UPDATE USING (
        EXISTS (
            SELECT 1 FROM public.goals 
            JOIN public.projects ON projects.id = goals.project_id
            WHERE goals.id = tasks.goal_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

CREATE POLICY "Users can delete tasks from own goals" ON public.tasks
    FOR DELETE USING (
        EXISTS (
            SELECT 1 FROM public.goals 
            JOIN public.projects ON projects.id = goals.project_id
            WHERE goals.id = tasks.goal_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

-- Schedules table policies
CREATE POLICY "Users can read own schedules" ON public.schedules
    FOR SELECT USING (auth.uid()::text = user_id::text);

CREATE POLICY "Users can create own schedules" ON public.schedules
    FOR INSERT WITH CHECK (auth.uid()::text = user_id::text);

CREATE POLICY "Users can update own schedules" ON public.schedules
    FOR UPDATE USING (auth.uid()::text = user_id::text);

CREATE POLICY "Users can delete own schedules" ON public.schedules
    FOR DELETE USING (auth.uid()::text = user_id::text);

-- Logs table policies
CREATE POLICY "Users can read logs from own tasks" ON public.logs
    FOR SELECT USING (
        EXISTS (
            SELECT 1 FROM public.tasks 
            JOIN public.goals ON goals.id = tasks.goal_id
            JOIN public.projects ON projects.id = goals.project_id
            WHERE tasks.id = logs.task_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

CREATE POLICY "Users can create logs for own tasks" ON public.logs
    FOR INSERT WITH CHECK (
        EXISTS (
            SELECT 1 FROM public.tasks 
            JOIN public.goals ON goals.id = tasks.goal_id
            JOIN public.projects ON projects.id = goals.project_id
            WHERE tasks.id = logs.task_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

CREATE POLICY "Users can update logs from own tasks" ON public.logs
    FOR UPDATE USING (
        EXISTS (
            SELECT 1 FROM public.tasks 
            JOIN public.goals ON goals.id = tasks.goal_id
            JOIN public.projects ON projects.id = goals.project_id
            WHERE tasks.id = logs.task_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );

CREATE POLICY "Users can delete logs from own tasks" ON public.logs
    FOR DELETE USING (
        EXISTS (
            SELECT 1 FROM public.tasks 
            JOIN public.goals ON goals.id = tasks.goal_id
            JOIN public.projects ON projects.id = goals.project_id
            WHERE tasks.id = logs.task_id 
            AND projects.owner_id::text = auth.uid()::text
        )
    );
```

### 4. Êé•Á∂ö„ÉÜ„Çπ„Éà
SQL„ÅåÊ≠£Â∏∏„Å´ÂÆüË°å„Åï„Çå„Åü„Çâ„ÄÅ‰ª•‰∏ã„ÅÆ„Ç≥„Éû„É≥„Éâ„ÅßÊé•Á∂ö„ÉÜ„Çπ„Éà„ÇíÂÆüË°åÔºö

```bash
python create_tables.py
```

## üìä Ê§úË®ºÁ¢∫Ë™ç‰∫ãÈ†Ö

### DATABASE_URL „Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞
- „Éë„Çπ„ÉØ„Éº„Éâ: `VxnZc8.cn&6G?`
- Ê≠£„Åó„ÅÑ„Ç®„É≥„Ç≥„Éº„Éâ: `VxnZc8.cn%266G%3F`
- ‚úÖ ÁèæÂú®„ÅÆ„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„ÅØÊ≠£„Åó„ÅÑ

### ÁâπÊÆäÊñáÂ≠ó„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
- `&` ‚Üí `%26` ‚úÖ
- `?` ‚Üí `%3F` ‚úÖ
- `.` ‚Üí „Åù„ÅÆ„Åæ„Åæ ‚úÖ

## üîß „Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞

### 1. Êé•Á∂ö„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„ÅüÂ†¥Âêà
- Supabase Dashboard „ÅßÂÆüÈöõ„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÜçÁ¢∫Ë™ç
- IPÂà∂ÈôêË®≠ÂÆö„ÇíÁ¢∫Ë™çÔºàSettings ‚Üí Database ‚Üí Network restrictionsÔºâ

### 2. „ÉÜ„Éº„Éñ„É´‰ΩúÊàê„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„ÅüÂ†¥Âêà  
- SQL Editor„Åß1„Å§„Åö„Å§ÂÆüË°å„Åó„Å¶„Ç®„É©„ÉºÁÆáÊâÄ„ÇíÁâπÂÆö
- Êó¢Â≠ò„ÉÜ„Éº„Éñ„É´„Å®„ÅÆÁ´∂Âêà„Çí„ÉÅ„Çß„ÉÉ„ÇØ

### 3. Ê®©Èôê„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„ÅüÂ†¥Âêà
- SERVICE_ROLE_KEY „ÅåÊ≠£„Åó„ÅèË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç
- RLS„Éù„É™„Ç∑„Éº„ÅåÈÅ©Âàá„Å´Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç

## üìû Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó
1. ‰∏äË®òSQL„ÇíSupabase Dashboard „ÅßÂÆüË°å
2. `python create_tables.py` „ÅßÊé•Á∂öÁ¢∫Ë™ç
3. FastAPI „Çµ„Éº„Éê„Éº (`python main.py`) „ÅßÂãï‰ΩúÁ¢∫Ë™ç